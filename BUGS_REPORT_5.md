# üêõ –û—Ç—á–µ—Ç –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –±–∞–≥–∞—Ö (QA Analysis - –†–∞—É–Ω–¥ 5: JavaScript –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-12-08  
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** QA Engineer  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** –ê–Ω–∞–ª–∏–∑ JavaScript –∫–æ–¥–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, XSS —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò

### BUG-33: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `loadCountries()`

**–§–∞–π–ª:** `templates/orders/order_form.html:356-368`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
function loadCountries() {
    fetch('{% url "get_countries" %}')
        .then(response => response.json())
        .then(data => {
            // ‚ö†Ô∏è –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò response.ok!
            // ‚ö†Ô∏è –ù–ï–¢ .catch() –î–õ–Ø –û–ë–†–ê–ë–û–¢–ö–ò –û–®–ò–ë–û–ö!
            const select = document.getElementById('factory_country');
            select.innerHTML = '<option value="">{% trans "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É" %}</option>';
            // ...
        });
}
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π (404, 500, —Å–µ—Ç–µ–≤–æ–π —Å–±–æ–π), –∫–æ–¥ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–∑–≤–∞—Ç—å `response.json()` –Ω–∞ –æ—à–∏–±–∫–µ
- –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º—É –∏—Å–∫–ª—é—á–µ–Ω–∏—é –≤ –∫–æ–Ω—Å–æ–ª–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–≤–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –≤ –Ω–µ—Ä–∞–±–æ—á–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

**–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
1. –û—Ç–∫–ª—é—á–∏—Ç—å —Å–µ—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
2. –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–±—Ä–∏–∫–∏
3. –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ—è–≤–∏—Ç—Å—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞
4. –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∑–Ω–∞–µ—Ç –ø–æ—á–µ–º—É

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
function loadCountries() {
    fetch('{% url "get_countries" %}')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            const select = document.getElementById('factory_country');
            if (!select) {
                console.error('Country select element not found');
                return;
            }
            select.innerHTML = '<option value="">{% trans "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É" %}</option>';
            data.countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.id;
                option.textContent = country.name;
                select.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Error loading countries:', error);
            showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'danger');
        });
}
```

---

### BUG-34: XSS —É—è–∑–≤–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ `innerHTML` –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª:** `templates/orders/order_form.html:546`, `templates/orders/notification_list.html:307`, `templates/orders/file_preview_modal.html:70+`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
alertDiv.innerHTML = `
    ${message}  // ‚ö†Ô∏è –ù–ï–¢ –≠–ö–†–ê–ù–ò–†–û–í–ê–ù–ò–Ø!
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
`;
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ï—Å–ª–∏ `message` —Å–æ–¥–µ—Ä–∂–∏—Ç HTML/JavaScript –∫–æ–¥, –æ–Ω –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ XSS –∞—Ç–∞–∫–∞–º.

**–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
1. –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å HTML —Ç–µ–≥–∞–º–∏: `<script>alert('XSS')</script>`
2. –ö–æ–¥ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `textContent` –≤–º–µ—Å—Ç–æ `innerHTML` –∏–ª–∏ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å HTML:
```javascript
const messageText = document.createTextNode(message);
alertDiv.appendChild(messageText);
const button = document.createElement('button');
button.type = 'button';
button.className = 'btn-close';
button.setAttribute('data-bs-dismiss', 'alert');
alertDiv.appendChild(button);
```

---

### BUG-35: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ `response.ok` –≤ `addCountry()`

**–§–∞–π–ª:** `templates/orders/order_form.html:371-398`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
fetch('{% url "create_country_ajax" %}', {
    method: 'POST',
    body: formData,
    headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
    }
})
.then(response => response.json())  // ‚ö†Ô∏è –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò response.ok!
.then(data => {
    // ...
});
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É (400, 500), –∫–æ–¥ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø–∞—Ä—Å–∏—Ç—å JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å –æ—à–∏–±–∫–æ–π, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–º—É –∏—Å–∫–ª—é—á–µ–Ω–∏—é.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `response.ok` –ø–µ—Ä–µ–¥ `response.json()`.

---

### BUG-36: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

**–§–∞–π–ª:** `templates/orders/order_form.html:334-353`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
document.getElementById('addFactoryModal').addEventListener('show.bs.modal', function() {
    loadCountries();  // ‚ö†Ô∏è –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò –°–£–©–ï–°–¢–í–û–í–ê–ù–ò–Ø –≠–õ–ï–ú–ï–ù–¢–ê!
});
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, `getElementById()` –≤–µ—Ä–Ω–µ—Ç `null`, –∏ –≤—ã–∑–æ–≤ `addEventListener()` –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –æ—à–∏–±–∫–µ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
const addFactoryModal = document.getElementById('addFactoryModal');
if (addFactoryModal) {
    addFactoryModal.addEventListener('show.bs.modal', function() {
        loadCountries();
    });
}
```

---

## üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### BUG-37: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ Select2 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª:** `templates/orders/order_form.html:330-575`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ï—Å–ª–∏ jQuery –∏–ª–∏ Select2 –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å, –∫–æ–¥ —É–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ª–∏—á–∏—è jQuery –∏ Select2 –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º.

---

### BUG-38: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö —Å–æ–±—ã—Ç–∏–π

**–§–∞–π–ª:** `templates/orders/order_form.html:332+`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –Ω–æ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è. –ü—Ä–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–µ –ø–∞–º—è—Ç–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∏–ª–∏ —É–¥–∞–ª—è—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö.

---

## üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### BUG-39: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–ª—è –¥–ª–∏–Ω—ã –ø–æ–ª–µ–π

**–§–∞–π–ª:** `templates/orders/order_form.html:209, 213, 240`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ï—Å—Ç—å `maxlength="3"` –¥–ª—è –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã, –Ω–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª–∏–Ω—ã –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª–∏–Ω—ã –ø–æ–ª–µ–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã.

---

### BUG-40: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ –≤ fetch –∑–∞–ø—Ä–æ—Å–∞—Ö

**–§–∞–π–ª:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å fetch –∑–∞–ø—Ä–æ—Å–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–µ –≤—Å–µ fetch –∑–∞–ø—Ä–æ—Å—ã –∏–º–µ—é—Ç `.catch()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å `.catch()` –∫–æ –≤—Å–µ–º fetch –∑–∞–ø—Ä–æ—Å–∞–º.

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –†–∞—É–Ω–¥–∞ 5

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤:** 4
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 2
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 2
- **–í—Å–µ–≥–æ:** 8 –±–∞–≥–æ–≤

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

1. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `response.ok`** –≤–æ –≤—Å–µ fetch –∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–¥ `response.json()`
2. **–î–æ–±–∞–≤–∏—Ç—å `.catch()`** –∫–æ –≤—Å–µ–º –ø—Ä–æ–º–∏—Å–∞–º –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
3. **–ó–∞–º–µ–Ω–∏—Ç—å `innerHTML` –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Ç–æ–¥—ã** (`textContent`, `createElement`)
4. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤** –ø–µ—Ä–µ–¥ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
5. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫** (jQuery, Select2) –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

---

## üìù –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–†–∞—É–Ω–¥ 1 + 2 + 3 + 4 + 5)

- **–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –±–∞–≥–æ–≤:** 40
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö:** 21
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 9
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 9
- **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 1

