#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

echo "üåç –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "manage.py" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: manage.py –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ gettext
if ! command -v msgfmt &> /dev/null; then
    echo "‚ùå –û—à–∏–±–∫–∞: gettext –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: apt-get install gettext"
    exit 1
fi

echo "üìù –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–≤–æ–¥–æ–≤..."
python manage.py makemessages -l ru
python manage.py makemessages -l de

echo "üîß –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤..."
python manage.py compilemessages

echo "‚úÖ –ü–µ—Ä–µ–≤–æ–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã!"
echo ""
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤:"
echo "  üá∑üá∫ –†—É—Å—Å–∫–∏–π:"
if [ -f "locale/ru/LC_MESSAGES/django.po" ]; then
    RU_COUNT=$(grep -c "^msgid" locale/ru/LC_MESSAGES/django.po)
    echo "    - –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: $RU_COUNT"
else
    echo "    - –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo "  üá©üá™ –ù–µ–º–µ—Ü–∫–∏–π:"
if [ -f "locale/de/LC_MESSAGES/django.po" ]; then
    DE_COUNT=$(grep -c "^msgid" locale/de/LC_MESSAGES/django.po)
    echo "    - –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: $DE_COUNT"
else
    echo "    - –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""
echo "üöÄ –ì–æ—Ç–æ–≤–æ! –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π."
