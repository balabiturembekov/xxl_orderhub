# üêõ –û—Ç—á–µ—Ç –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –±–∞–≥–∞—Ö (QA Analysis - –†–∞—É–Ω–¥ 8)

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 9 –¥–µ–∫–∞–±—Ä—è 2025  
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** QA Engineer  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### BUG-57: N+1 –∑–∞–ø—Ä–æ—Å –≤ `EFacturaBasketDetailView` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `.count()` –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª:** `orders/views/efactura_views.py:125`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
def get_context_data(self, **kwargs):
    context = super().get_context_data(**kwargs)
    basket = self.get_object()
    
    context['total_files'] = basket.files.count()  # ‚ö†Ô∏è N+1 –∑–∞–ø—Ä–æ—Å!
    return context
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í `get_context_data` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å `.count()` –∫ `basket.files`. –ï—Å–ª–∏ –≤ `get_queryset` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `prefetch_related('files')`, —ç—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º—É SQL –∑–∞–ø—Ä–æ—Å—É. –•–æ—Ç—è —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ–¥–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã, –Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É.

**–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–µ–π –∫–æ—Ä–∑–∏–Ω—ã E-Factura
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ Django Debug Toolbar
3. –£–≤–∏–¥–µ—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å `SELECT COUNT(*) FROM orders_efacturafile WHERE basket_id = X`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `prefetch_related` –≤ `get_queryset` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `len()` –¥–ª—è —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤:
```python
def get_queryset(self):
    return EFacturaBasket.objects.prefetch_related('files')

def get_context_data(self, **kwargs):
    context = super().get_context_data(**kwargs)
    basket = self.get_object()
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º len() –¥–ª—è —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
    context['total_files'] = len(basket.files.all())
    return context
```

---

### BUG-58: N+1 –∑–∞–ø—Ä–æ—Å –≤ `FactoryDetailView` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `.count()` –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª:** `orders/views/management_views.py:209`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
factory = get_object_or_404(Factory, pk=pk)

# Check if factory has associated orders
orders_count = factory.order_set.count()  # ‚ö†Ô∏è N+1 –∑–∞–ø—Ä–æ—Å!
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å `.count()` –∫ `factory.order_set`. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `annotate()` –∏–ª–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã.

**–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–µ–π —Ñ–∞–±—Ä–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
3. –£–≤–∏–¥–µ—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å `SELECT COUNT(*) FROM orders_order WHERE factory_id = X`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `annotate()` –∏–ª–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å:
```python
from django.db.models import Count

factory = get_object_or_404(
    Factory.objects.annotate(orders_count=Count('order')),
    pk=pk
)

orders_count = factory.orders_count
```

---

## üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### BUG-59: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è XSS —É—è–∑–≤–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ `innerHTML` –≤ —à–∞–±–ª–æ–Ω–∞—Ö

**–§–∞–π–ª—ã:** 
- `templates/orders/file_preview_modal.html:70, 86, 95, 172, 208, 228`
- `templates/orders/email_template_form.html:337, 358, 367`
- `templates/orders/email_template_detail.html:292, 313, 322`
- `templates/orders/notification_list.html:307`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
container.innerHTML = html;  // ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è XSS —É—è–∑–≤–∏–º–æ—Å—Ç—å!
button.innerHTML = '<i class="fas fa-check-circle me-1"></i>–ü—Ä–æ—á–∏—Ç–∞–Ω–æ';
previewContent.innerHTML = `<div>${content}</div>`;
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `innerHTML` –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ XSS –∞—Ç–∞–∫–∞–º, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –±—ã–ª –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –•–æ—Ç—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –Ω–æ –µ—Å–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å –Ω–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ –∫–æ–¥–∞.

**–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
1. –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞ –µ—Å—Ç—å HTML —Ç–µ–≥–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `<script>alert('XSS')</script>`)
2. –ò —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `innerHTML`
3. –ö–æ–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `textContent` –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–ª–∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ HTML —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```javascript
// –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
container.textContent = content;

// –î–ª—è HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞ - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
// –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DOMPurify –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ HTML
container.innerHTML = DOMPurify.sanitize(html);
```

---

### BUG-60: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ `paginate_by` - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è DoS –∞—Ç–∞–∫–∞

**–§–∞–π–ª—ã:**
- `orders/views/efactura_views.py:45`
- `orders/views/confirmation_views.py:40`
- `orders/views/shipment_views.py:39`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
class EFacturaBasketListView(ListView):
    paginate_by = 20  # ‚ö†Ô∏è –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–•–æ—Ç—è `paginate_by` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, –Ω–æ –µ—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω—è—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `?page_size=10000`), —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- –û—á–µ–Ω—å –±–æ–ª—å—à–∏–º –∑–∞–ø—Ä–æ—Å–∞–º –∫ –ë–î
- –ú–µ–¥–ª–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π DoS –∞—Ç–∞–∫–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π `page_size`, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é:
```python
def get_paginate_by(self, queryset):
    page_size = self.request.GET.get('page_size', self.paginate_by)
    try:
        page_size = int(page_size)
        if page_size < 1:
            page_size = self.paginate_by
        elif page_size > ViewConstants.MAX_PAGE_SIZE:
            page_size = ViewConstants.MAX_PAGE_SIZE
    except (ValueError, TypeError):
        page_size = self.paginate_by
    return page_size
```

---

## üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### BUG-61: –°–ª–∏—à–∫–æ–º –æ–±—â–∏–µ `except Exception` –±–ª–æ–∫–∏ - —Å–∫—Ä—ã—Ç–∏–µ –≤–∞–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫

**–§–∞–π–ª—ã:**
- `orders/views/efactura_views.py:205, 255, 322, 343`
- `orders/views/confirmation_views.py:507, 557, 573, 702, 759, 896, 923, 932, 1038, 1054, 1062`
- `orders/models.py:858, 995, 1064, 1091, 1578, 1663`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
try:
    # ... –∫–æ–¥ ...
except Exception as e:  # ‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫!
    logger.error(f"–û—à–∏–±–∫–∞: {e}")
    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –æ–±—â–µ–≥–æ `except Exception` –º–æ–∂–µ—Ç —Å–∫—Ä—ã—Ç—å –≤–∞–∂–Ω—ã–µ –æ—à–∏–±–∫–∏, —Ç–∞–∫–∏–µ –∫–∞–∫:
- `KeyboardInterrupt` - –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- `SystemExit` - –≤—ã—Ö–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `MemoryError` - –Ω–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏
- –î—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø–æ-–¥—Ä—É–≥–æ–º—É

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
```python
try:
    # ... –∫–æ–¥ ...
except (ValueError, TypeError, AttributeError) as e:
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–∂–∏–¥–∞–µ–º—ã–µ –æ—à–∏–±–∫–∏
    logger.error(f"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: {e}")
except IntegrityError as e:
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –ë–î
    logger.error(f"–û—à–∏–±–∫–∞ –ë–î: {e}")
except Exception as e:
    # –¢–æ–ª—å–∫–æ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
    logger.exception(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
    raise  # –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–ª—å—à–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ
```

---

### BUG-62: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç—ã–µ queryset –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `.count()`

**–§–∞–π–ª—ã:**
- `orders/views/efactura_views.py:125`
- `orders/views/management_views.py:209`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
orders_count = factory.order_set.count()  # ‚ö†Ô∏è –í—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫ –ë–î
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–•–æ—Ç—è `.count()` –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ Django, –Ω–æ –µ—Å–ª–∏ queryset —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –ø–∞–º—è—Ç—å, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `len()` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ï—Å–ª–∏ queryset —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `len()`:
```python
# –ï—Å–ª–∏ queryset —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
orders = factory.order_set.all()
orders_count = len(orders)  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

# –ï—Å–ª–∏ queryset –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
orders_count = factory.order_set.count()  # –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –ë–î
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –†–∞—É–Ω–¥–∞ 8

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤:** 2 (N+1 –∑–∞–ø—Ä–æ—Å—ã)
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 2 (XSS, DoS)
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 2 (–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
- **–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –±–∞–≥–æ–≤:** 6

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π):
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ `EFacturaBasketDetailView` –∏ `FactoryDetailView`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `prefetch_related` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `annotate()` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í—ã—Å–æ–∫–∏–π):
3. ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å `innerHTML` –Ω–∞ `textContent` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DOMPurify
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è `page_size` –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–°—Ä–µ–¥–Ω–∏–π):
5. ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å –æ–±—â–∏–µ `except Exception` –Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
6. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `len()` –¥–ª—è —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö queryset –≤–º–µ—Å—Ç–æ `.count()`

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –±–∞–≥–æ–≤ —Å–≤—è–∑–∞–Ω—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é
- XSS —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —Ç—Ä–µ–±—É—é—Ç –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è, —Ç–∞–∫ –∫–∞–∫ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è –∞—Ç–∞–∫
- N+1 –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –º–æ–≥—É—Ç —Å—Ç–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏

