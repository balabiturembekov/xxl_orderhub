# üêõ –û—Ç—á–µ—Ç –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –±–∞–≥–∞—Ö (QA Analysis - –†–∞—É–Ω–¥ 4: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–∞–≥–∏)

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-12-08  
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** QA Engineer  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** –ê–Ω–∞–ª–∏–∑ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, edge cases

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò

### BUG-25: –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å `final_payment` - —Å—Ç–∞—Ç—É—Å 'paid' –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É–º–º—ã

**–§–∞–π–ª:** `orders/models.py:1056-1057`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
elif last_payment.payment_type == 'final_payment':
    self.status = 'paid'  # ‚ö†Ô∏è –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è 'paid' –ë–ï–ó –ü–†–û–í–ï–†–ö–ò –°–£–ú–ú–´!
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–ª–∞—Ç–µ–∂ –∏–º–µ–µ—Ç —Ç–∏–ø `final_payment`, —Å—Ç–∞—Ç—É—Å –∏–Ω–≤–æ–π—Å–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `'paid'`, **–¥–∞–∂–µ –µ—Å–ª–∏ —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤–µ—Å—å –æ—Å—Ç–∞—Ç–æ–∫**. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- –ò–Ω–≤–æ–π—Å–∞–º —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `'paid'`, –Ω–æ —Å –Ω–µ–ø–æ–≥–∞—à–µ–Ω–Ω—ã–º –æ—Å—Ç–∞—Ç–∫–æ–º
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
- –ü–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–∞–ª—å–Ω–æ–º —Å—Ç–∞—Ç—É—Å–µ –æ–ø–ª–∞—Ç—ã

**–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å —Å –±–∞–ª–∞–Ω—Å–æ–º 1000
2. –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ –Ω–∞ 100 —Å —Ç–∏–ø–æ–º `partial_payment` (–æ—Å—Ç–∞—Ç–æ–∫: 900)
3. –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ –Ω–∞ 50 —Å —Ç–∏–ø–æ–º `final_payment`
4. –°—Ç–∞—Ç—É—Å –∏–Ω–≤–æ–π—Å–∞ –±—É–¥–µ—Ç `'paid'`, —Ö–æ—Ç—è –æ—Å—Ç–∞—Ç–æ–∫ 850!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É–º–º—É –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Å—Ç–∞—Ç—É—Å–∞:
```python
elif last_payment.payment_type == 'final_payment':
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—É–º–º–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫
    if self.total_paid >= balance_decimal:
        self.status = 'paid'
    else:
        self.status = 'partial'  # –§–∏–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞—Ç–µ–∂, –Ω–æ —Å—É–º–º–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞
```

---

### BUG-26: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–≤–æ–π—Å–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞

**–§–∞–π–ª:** `orders/views/payment_views.py:249-341`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
def form_valid(self, form):
    invoice = self.get_invoice()
    # ‚ö†Ô∏è –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò invoice.status == 'paid'!
    payment = form.save(commit=False)
    payment.invoice = invoice
    payment.save()
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ –¥–ª—è —É–∂–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∏–Ω–≤–æ–π—Å–∞ (`status == 'paid'`). –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫:
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –¥–∞–Ω–Ω—ã–º (–ø–ª–∞—Ç–µ–∂–∏ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç—ã)
- –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º—É `remaining_amount`
- –ù–∞—Ä—É—à–µ–Ω–∏—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

**–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å —Å –±–∞–ª–∞–Ω—Å–æ–º 1000
2. –û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Å—Ç–∞—Ç—É—Å `'paid'`)
3. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –µ—â–µ –æ–¥–∏–Ω –ø–ª–∞—Ç–µ–∂
4. –ü–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞—Å—Ç—Å—è —É—Å–ø–µ—à–Ω–æ!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–ª–∞—Ç–µ–∂–∞:
```python
if invoice.status == 'paid':
    messages.error(self.request, '–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å –ø–ª–∞—Ç–µ–∂–∏ –∫ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω–Ω–æ–º—É –∏–Ω–≤–æ–π—Å—É!')
    return self.form_invalid(form)
```

---

### BUG-27: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã –ø–ª–∞—Ç–µ–∂–∞

**–§–∞–π–ª:** `orders/forms.py:486-502`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
def clean_amount(self):
    # –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã
    # ‚ö†Ô∏è –ù–ï–¢ clean_payment_date()!
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞—Ç—ã –ø–ª–∞—Ç–µ–∂–∞ –≤ `InvoicePaymentForm`. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
- –£–∫–∞–∑–∞—Ç—å –±—É–¥—É—â—É—é –¥–∞—Ç—É –¥–ª—è –ø—Ä–æ—à–ª–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- –£–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞
- –£–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É —Ä–∞–Ω—å—à–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π

**–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å —Å –¥–∞—Ç–æ–π —Å–æ–∑–¥–∞–Ω–∏—è 2025-01-01
2. –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ —Å –¥–∞—Ç–æ–π 2024-12-01 (—Ä–∞–Ω—å—à–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞)
3. –ü–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞—Å—Ç—Å—è —É—Å–ø–µ—à–Ω–æ!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `clean_payment_date()`:
```python
def clean_payment_date(self):
    payment_date = self.cleaned_data.get('payment_date')
    if payment_date:
        today = timezone.now().date()
        # –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 1 –¥–µ–Ω—å (–¥–ª—è —É—á–µ—Ç–∞ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤)
        if payment_date > today + timedelta(days=1):
            raise ValidationError("–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º.")
        # –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞
        if self.invoice and payment_date < self.invoice.created_at.date():
            raise ValidationError("–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞.")
    return payment_date
```

---

### BUG-28: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ `InvoiceWithPaymentForm.clean_payment_amount()`

**–§–∞–π–ª:** `orders/forms.py:732-749`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
if balance and amount and amount > balance:
    raise ValidationError(
        f"–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ ({amount}) –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –æ–±—â—É—é —Å—É–º–º—É –∏–Ω–≤–æ–π—Å–∞ ({balance})."
    )
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ `amount > balance` (–æ–±—â–∞—è —Å—É–º–º–∞ –∏–Ω–≤–æ–π—Å–∞), –Ω–æ **–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `remaining_amount`**. –ï—Å–ª–∏ –∏–Ω–≤–æ–π—Å —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –æ–ø–ª–∞—á–µ–Ω, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ –±–æ–ª—å—à–µ —á–µ–º `remaining_amount`, –Ω–æ –º–µ–Ω—å—à–µ —á–µ–º `balance`.

**–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å —Å –±–∞–ª–∞–Ω—Å–æ–º 1000
2. –û–ø–ª–∞—Ç–∏—Ç—å 600 (–æ—Å—Ç–∞—Ç–æ–∫: 400)
3. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∏–Ω–≤–æ–π—Å–∞ —Å –ø–ª–∞—Ç–µ–∂–æ–º —É–∫–∞–∑–∞—Ç—å amount=500, balance=1000
4. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ—Ç (500 < 1000), –Ω–æ —ç—Ç–æ –±–æ–ª—å—à–µ –æ—Å—Ç–∞—Ç–∫–∞!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—è—Ç—å `remaining_amount` –≤–º–µ—Å—Ç–æ `balance` –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–≤–æ–π—Å–æ–≤.

---

## üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### BUG-29: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–∞

**–§–∞–π–ª:** `orders/models.py:248-265`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
def mark_as_sent(self):
    self.status = 'sent'  # ‚ö†Ô∏è –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò –¢–ï–ö–£–©–ï–ì–û –°–¢–ê–¢–£–°–ê!
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ú–µ—Ç–æ–¥—ã `mark_as_sent()`, `mark_invoice_received()`, `mark_as_completed()` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞. –ú–æ–∂–Ω–æ:
- –í—ã–∑–≤–∞—Ç—å `mark_as_sent()` –¥–ª—è –∑–∞–∫–∞–∑–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `'completed'`
- –í—ã–∑–≤–∞—Ç—å `mark_as_completed()` –¥–ª—è –∑–∞–∫–∞–∑–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `'uploaded'`
- –ù–∞—Ä—É—à–∏—Ç—å –ª–æ–≥–∏–∫—É workflow

**–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ (—Å—Ç–∞—Ç—É—Å `'uploaded'`)
2. –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑: `order.mark_as_completed()` (—Å—Ç–∞—Ç—É—Å `'completed'`)
3. –í—ã–∑–≤–∞—Ç—å `order.mark_as_sent()` (—Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ `'sent'`!)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:
```python
def mark_as_sent(self):
    if self.status != 'uploaded':
        raise ValueError(f'–ù–µ–ª—å–∑—è –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∑–∞–∫–∞–∑ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º {self.status}')
    self.status = 'sent'
    self.sent_at = timezone.now()
    self.save()
```

---

### BUG-30: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞

**–§–∞–π–ª:** `orders/views/payment_views.py:345-420`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
class PaymentUpdateView(UpdateView):
    # ‚ö†Ô∏è –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò invoice.status == 'paid'!
    # ‚ö†Ô∏è –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò —á—Ç–æ –Ω–æ–≤—ã–π amount –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç remaining_amount!
```

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
- –ú–æ–∂–Ω–æ –ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂ –¥–ª—è –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ –∏–Ω–≤–æ–π—Å–∞
- –ù–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏ –Ω–æ–≤–∞—è —Å—É–º–º–∞ `remaining_amount` (—Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ `form_valid()`.

---

## üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### BUG-31: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã –≤ `InvoiceWithPaymentForm`

**–§–∞–π–ª:** `orders/forms.py:592-750`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–µ—Ç –º–µ—Ç–æ–¥–∞ `clean_payment_date()` –≤ `InvoiceWithPaymentForm`. –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ª—é–±—É—é –¥–∞—Ç—É –¥–ª—è –ø–ª–∞—Ç–µ–∂–∞.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞—Ç—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `InvoicePaymentForm`.

---

### BUG-32: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ `due_date` –Ω–µ —Ä–∞–Ω—å—à–µ `created_at`

**–§–∞–π–ª:** `orders/models.py:923-930`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í –º–æ–¥–µ–ª–∏ `Invoice` –ø–æ–ª–µ `due_date` –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ `Invoice.clean()`:
```python
if self.due_date and self.created_at and self.due_date < self.created_at.date():
    raise ValidationError({'due_date': '–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞.'})
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –†–∞—É–Ω–¥–∞ 4

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤:** 4
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 2
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 2
- **–í—Å–µ–≥–æ:** 8 –±–∞–≥–æ–≤

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

1. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É–º–º—ã –¥–ª—è `final_payment`** –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Å—Ç–∞—Ç—É—Å–∞ `'paid'`
2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–≤–æ–π—Å–∞** –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø–ª–∞—Ç–µ–∂–µ–π
3. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞—Ç –ø–ª–∞—Ç–µ–∂–µ–π** (–Ω–µ –≤ –±—É–¥—É—â–µ–º, –Ω–µ —Ä–∞–Ω—å—à–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞)
4. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–æ–≤** –≤ –º–µ—Ç–æ–¥–∞—Ö `mark_as_*`
5. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ `InvoiceWithPaymentForm`** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `remaining_amount`

---

## üìù –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–†–∞—É–Ω–¥ 1 + –†–∞—É–Ω–¥ 2 + –†–∞—É–Ω–¥ 3 + –†–∞—É–Ω–¥ 4)

- **–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –±–∞–≥–æ–≤:** 32
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö:** 17
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 7
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 7
- **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 1

